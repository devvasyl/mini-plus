# 永不过时的话题：原型与原型链的实战详解

### 前言

最近在跟卡颂群里的一些同学进行了关于原型与原型链的讨论，于是我进行了总结，查漏补缺，便了有这篇文章。

首先在 JavaScript 中有一切皆对象的说法，那么就说明 **对象** 在 JavaScript 中非常重要。其实在 JavaScript 中的面向对象的实质是基于原型的对象系统，而不是基于类。当然现在ES6 之后的 JavaScript 已经拥有基于类的编程方式了，但通过 babel 编译之后，本质还是基于原型与原型链来实现的。所以对 JavaScript 中的原型与原型链的理解与掌握是前端进阶的重要组成部分。

本文将先讲解关于原型与原型链的基础知识，然后再延伸讲解它们的实际应用场景，比如在 Vue2 源码中的应用，在 Vue3 源码中应用，及其他一些场景的应用加深对原型与原型链的理解。

### 原型与原型链的基础定义理解

关于原型与原型链下面这些基础 JavaScript 知识一定要 “死记硬背” 的。只有 “死记“，才能 “用活”。

1. 对象是某个特定引用类型的实例，可以理解为对象要通过构造函数实例化实现的，而构造函数本身又是一个对象，构造函数本身又需要通过构造函数实现。
2. JavaScript 提供了很多原生引用类型：Object、Array、Function、String、Number、Boolean、Date、RegExp，同时它们也都是原生构造函数
3. 每个函数都是 Function 类型的实例
4. 对象的隐式原型（`__proto__` 属性）指向它的构造函数的原型对象（`prototype` 属性）
5. 每个构造函数都有一个 prototype 属性，叫原型对象（注意：原型对象，本质是对象）
6. 原型对象上有一个 constructor 属性指向构造函数本身
7. 通过 new 实例化出来的对象没有 prototype 属性

上面的规则 1 和 3 可以结合一起理解。怎么说呢？

我们知道对象是可以这样实现的 `const obj = new Object()`  那么 obj 就是引用类型 Object 的实例，

根据定义1：Object 本身也是对象
根据定义3：Object 作为函数对象是通过构造函数 Function 实例化实现
根据定义4：`Object.__proto__ === Function.prototype`

根据定义1：Function 本身也是对象
根据定义3：Function 作为函数对象是通过构造函数 Function 实例化实现
根据定义4：`Function.__proto__ === Function.prototype`

根据定义1：普通函数 本身也是对象
根据定义3：普通函数 函数对象是通过构造函数 Function 实例化实现
根据定义4：`普通函数.__proto__ === Function.prototype`

例如：

```javascript
function fn() {}
fn.__proto__ === Function.prototype // true
```

关于 xxx.prototype
首先这个 xxx.prototype 中文叫 xxx 原型对象
既然是对象那么就拥有 `__proto__` 属性
既然是对象那么就是通过构造函数实例化而来

Function.prototype 这个原型对象是通过 Object 这个构造函数实例化实现

所以：`Function.prototype.__proto__ === Object.prototype`

而

`Object.prototype.__proto__  === null` 这个是宇宙的尽头没什么好说的

关于所有函数对象都是通过构造函数 Function 实例化实现这个怎么理解

比如你声明一个函数

```javascript
function Fn() {
    console.log('cobyte')
}
Fn() // cobyte
```

其实还可以这样实现

```javascript
const Fn = new Function("console.log('cobyte')")
Fn() // cobyte
```

这个时候根据上面的定义4：对象的隐式原型指向它的构造函数的原型对象，可以很清楚得知

`Fn.__proto__ === Function.prototype`

所以你再声明一个普通函数

function Test() {}

这个时候，你就很清楚知道

`Test.__proto__ === Function.prototype`

拓展延伸

String 作为字符串的构造函数对象，String 也是通过的 Function 的实例化而来。

所以：`String.__proto__ === Function.prototype`

Number 作为数字的构造函数对象，Number 也是通过 Function 的实例化而来。

所以：`Number.__proto__ === Function.prototype`

Boolean 作为布尔类型的构造函数对象，Boolean 也是通过 Function 的实例化而来。

所以：`Boolean.__proto__ === Function.prototype`

`Map.__proto__ === Function.prototype`

`WeakMap.__proto__ === Function.prototype`

### 关于 JavaScript 中一切皆是对象的理解

